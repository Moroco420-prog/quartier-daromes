{# 
  COMPOSANT CARTE PRODUIT UNIFORME
  Usage: {% include 'components/product_card.html' with context %}
  Variables requises: product
#}

<div class="product-card-uniform">
    <!-- Image Produit -->
    <div class="product-image-container">
        <a href="{{ url_for('product_detail', product_id=product.id) }}">
            {% if product.image_url %}
                <img src="{{ url_for('static', filename='uploads/' ~ product.image_url) }}" 
                     class="product-image"
                     alt="{{ product.name }}"
                     loading="lazy"
                     onerror="this.src='{{ url_for('static', filename='images/product-placeholder.svg') }}'">
            {% else %}
                <div class="product-placeholder">
                    <i class="bi bi-image"></i>
                </div>
            {% endif %}
        </a>
        
        <!-- Badge Stock -->
        {% if product.stock > 0 %}
            <span class="product-badge badge-stock">En stock</span>
        {% else %}
            <span class="product-badge badge-outofstock">Rupture</span>
        {% endif %}
    </div>
    
    <!-- Info Produit -->
    <div class="product-info">
        <a href="{{ url_for('product_detail', product_id=product.id) }}" class="product-name">
            {{ product.name }}
        </a>
        
        <div class="product-meta">
            {% if product.brand %}
                <span class="product-brand">{{ product.brand }}</span>
            {% endif %}
            {% if product.avg_rating %}
                <div class="product-rating">
                    {% for i in range(5) %}
                        <i class="bi bi-star-fill {% if i < product.avg_rating|round %}text-warning{% else %}text-muted{% endif %}"></i>
                    {% endfor %}
                    <span class="rating-count">({{ product.review_count|default(0) }})</span>
                </div>
            {% endif %}
        </div>
        
        <div class="product-price">{{ product.price }} DH</div>
    </div>
    
    <!-- Actions -->
    <div class="product-actions">
        <!-- Ajouter au panier -->
        <form action="{{ url_for('add_to_cart', product_id=product.id) }}" 
              method="POST" 
              class="action-form" 
              data-product-name="{{ product.name }}"
              data-product-price="{{ product.price }}"
              data-product-image="{{ product.image_url }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" name="quantity" value="1">
            <button type="submit" class="btn-add-cart" {% if product.stock <= 0 %}disabled{% endif %}>
                <i class="bi bi-cart-plus"></i> 
            </button>
        </form>
        
        <!-- Ajouter aux favoris -->
        {% if current_user.is_authenticated %}
            <form action="{{ url_for('add_to_wishlist', product_id=product.id) }}" 
                  method="POST" 
                  class="action-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <button type="submit" class="btn-add-wishlist" title="Ajouter aux favoris">
                    <i class="bi bi-heart"></i>
                </button>
            </form>
        {% else %}
            <a href="{{ url_for('login') }}" class="btn-add-wishlist" title="Connectez-vous pour ajouter aux favoris">
                <i class="bi bi-heart"></i>
            </a>
        {% endif %}
    </div>
</div>

<style>
/* ========== CARTE PRODUIT UNIFORME ========== */
.product-card-uniform {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
}

.product-card-uniform:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    transform: translateY(-4px);
}

/* Image Container */
.product-image-container {
    position: relative;
    width: 100%;
    padding-top: 100%; /* Ratio 1:1 */
    overflow: hidden;
    background: #f8f9fa;
}

.product-image-container a {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.product-card-uniform:hover .product-image {
    transform: scale(1.05);
}

.product-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f0f0f0;
    color: #999;
    font-size: 3rem;
}

/* Badges */
.product-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 0.35rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    z-index: 2;
}

.badge-stock {
    background: #28a745;
    color: white;
}

.badge-outofstock {
    background: #dc3545;
    color: white;
}

/* Info Produit */
.product-info {
    padding: 1rem;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
}

.product-name {
    font-size: 1rem;
    font-weight: 600;
    color: #1a1a1a;
    text-decoration: none;
    margin-bottom: 0.5rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.4;
    min-height: 2.8em;
}

.product-name:hover {
    color: #C4942F;
}

.product-meta {
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
}

.product-brand {
    color: #6c757d;
    font-weight: 500;
}

.product-rating {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    margin-top: 0.25rem;
}

.product-rating i {
    font-size: 0.75rem;
}

.rating-count {
    font-size: 0.75rem;
    color: #6c757d;
    margin-left: 0.25rem;
}

.product-price {
    font-size: 1.25rem;
    font-weight: 700;
    color: #C4942F;
    margin-top: auto;
}

/* Actions */
.product-actions {
    padding: 0 1rem 1rem;
    display: flex;
    gap: 0.5rem;
}

.action-form {
    flex: 1;
}

.btn-add-cart {
    width: 100%;
    background: #C4942F;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.btn-add-cart:hover:not(:disabled) {
    background: #a67c26;
    box-shadow: 0 4px 12px rgba(196, 148, 47, 0.3);
}

.btn-add-cart:disabled {
    background: #ccc;
    cursor: not-allowed;
    opacity: 0.6;
}

.btn-add-wishlist {
    width: 48px;
    height: 48px;
    background: white;
    color: #6c757d;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1.25rem;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
}

.btn-add-wishlist:hover {
    border-color: #dc3545;
    color: #dc3545;
    background: #fff5f5;
}

/* Responsive */
@media (max-width: 768px) {
    .product-info {
        padding: 0.75rem;
    }
    
    .product-actions {
        padding: 0 0.75rem 0.75rem;
    }
    
    .product-name {
        font-size: 0.9rem;
    }
    
    .product-price {
        font-size: 1.1rem;
    }
    
    .btn-add-cart {
        padding: 0.6rem 0.8rem;
        font-size: 0.8rem;
    }
    
    .btn-add-wishlist {
        width: 44px;
        height: 44px;
    }
}
</style>
